import t from"crypto";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,r){return(l=h()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&f(o,r.prototype),o}).apply(null,arguments)}function p(t){var e="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return l(t,arguments,a(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,t)})(t)}function d(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?d(t):e}function y(t,e,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}for(var g,m={message:"Parse error",code:-32700},w={message:"Invalid request",code:-32600},b={message:"Method not found",code:-32601},v={message:"Invalid params",code:-32602},R={message:"Internal error",code:-32603},E=Object.freeze({__proto__:null,JSONRPC_VERSION:"2.0",PARSE_ERROR:m,INVALID_REQUEST_ERROR:w,NOT_FOUND_ERROR:b,INVALID_PARAMS_ERROR:v,INTERNAL_ERROR:R}),O=function(t){function e(t,n,o){var i;return r(this,e),(i=_(this,a(e).call(this,n))).code=t,i.data=o,i.name=i.constructor.name,Error.captureStackTrace(d(i),i.constructor),i}return c(e,p(Error)),o(e,[{key:"toJSON",value:function(){return{code:this.code,data:this.data,message:this.message}}}]),e}(),j=function(t){function e(t){return r(this,e),_(this,a(e).call(this,R.code,R.message,t))}return c(e,O),e}(),k=function(t){function e(t){return r(this,e),_(this,a(e).call(this,v.code,v.message,t))}return c(e,O),e}(),S=function(t){function e(t){return r(this,e),_(this,a(e).call(this,w.code,w.message,t))}return c(e,O),e}(),P=function(t){function e(t){return r(this,e),_(this,a(e).call(this,b.code,b.message,t))}return c(e,O),e}(),q=function(t){function e(t){return r(this,e),_(this,a(e).call(this,m.code,m.message,t))}return c(e,O),e}(),D=function(){function t(){r(this,t),this._handlers={}}return o(t,[{key:"_has",value:function(t){return Array.isArray(this._handlers[t])}},{key:"on",value:function(t,e){this._has(t)||(this._handlers[t]=[]),this._handlers[t].push(e)}},{key:"emit",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this._has(t)&&this._handlers[t].forEach((function(t){t.apply(void 0,r)}))}},{key:"remove",value:function(t,e){this._has(t)&&(this._handlers[t]=this._handlers[t].filter((function(t){return t!==e})))}}]),t}(),A=function(){function t(e){r(this,t),this.jsonrpc=e}return o(t,[{key:"toString",value:function(){return{jsonrpc:this.jsonrpc}}},{key:"jsonrpc",get:function(){return this._jsonrpc},set:function(t){if("2.0"!==t)throw new Error("jsonrpc is required, ".concat("2.0"," expected"));this._jsonrpc=t}}]),t}(),I=function(t){function n(t,e,o){var i;return r(this,n),(i=_(this,a(n).call(this,t))).error=e,i.id=o,i}return c(n,A),o(n,[{key:"toString",value:function(){return u({},y(a(n.prototype),"toString",this).call(this),{error:this.error,id:this.id})}},{key:"error",get:function(){return this._error},set:function(t){if("object"!==e(t))throw new Error("error must be object");if("number"!=typeof t.code)throw new Error("error must has code, typeof number");if("string"!=typeof t.message||0===t.message.length)throw new Error("error must has message, typeof string, not empty");this._error=t}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),n}(),N=function(t){function n(t,e,o,i){var s;return r(this,n),(s=_(this,a(n).call(this,t))).method=e,s.params=o,s.id=i,s}return c(n,A),o(n,[{key:"toString",value:function(){return u({},y(a(n.prototype),"toString",this).call(this),{method:this.method,params:this.params,id:this.id})}},{key:"method",get:function(){return this._method},set:function(t){if("string"==typeof t&&t.length>0)return this._method=t;throw new Error("method must be not empty string")}},{key:"params",get:function(){return this._params},set:function(t){if(null===t)throw new Error("params must be ommited | array | object, got null");if("object"===e(t)||void 0===t)return this._params=t;throw new Error("params must be ommited | array | object")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null==t)return this._id=t;throw new Error("id must be ommited | int | string | null")}}]),n}(),M=function(t){function e(t,n,o){var i;return r(this,e),(i=_(this,a(e).call(this,t))).result=n,i.id=o,i}return c(e,A),o(e,[{key:"toString",value:function(){return u({},y(a(e.prototype),"toString",this).call(this),{result:this.result,id:this.id})}},{key:"result",get:function(){return this._result},set:function(t){if(void 0!==t)return this._result=t;throw new Error("result is required")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),e}(),T=function(t){function n(){var t;return r(this,n),i(d(t=_(this,a(n).call(this))),"onMessage",(function(e){var r=t._toJson(e);t._toMessages(r).forEach(t._parseMessage)})),i(d(t),"_parseMessage",(function(r){if("object"!==e(r))return t.emit("error",new q("message in not an object, ".concat(e(r)," recieved")));var n,o,i=r.jsonrpc,s=r.method,u=r.params,c=r.result,a=r.error,f=r.id;try{void 0!==s&&(n="request",o=new N(i,s,u,f)),void 0!==c&&(n="response",o=new M(i,c,f)),void 0!==a&&(n="response_error",o=new I(i,a,f))}catch(a){return t.emit("error",new q(a.message))}return n&&o?t.emit(n,o):t.emit("error",new q("invalid message, json-rpc 2.0 format required"))})),t}return c(n,D),o(n,[{key:"_toJson",value:function(t){try{return JSON.parse(t)}catch(t){this.emit("error",new q(t.message))}}},{key:"_toMessages",value:function(t){return Array.isArray(t)?t:[t]}}]),n}(),x={_send:function(t){this._ws.send(JSON.stringify(u({jsonrpc:"2.0"},t)))}},J=g={__proto__:x,throw:function(t,e){y(a(g),"_send",this).call(this,{id:t,error:e})},throwRPCError:function(t,e,r,n){this.throw(t,new O(e,r,n))},_throwDefaultError:function(t,e,r){this.throw(t,new r(e))},throwParseError:function(t,e){this._throwDefaultError(t,e,q)},throwInvalidRequest:function(t,e){this._throwDefaultError(t,e,S)},throwNotFound:function(t,e){this._throwDefaultError(t,e,P)},throwInvalidParams:function(t,e){this._throwDefaultError(t,e,k)},throwInternalError:function(t,e){this._throwDefaultError(t,e,j)}},L=function(){return t.randomBytes(16)},C=[],F=0;F<256;++F)C[F]=(F+256).toString(16).substr(1);var V=function(t,e){var r=e||0,n=C;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")};var B,U,W=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||L)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;++i)e[n+i]=o[i];return e||V(o)},z=B={__proto__:x,notify:function(t,e){y(a(B),"_send",this).call(this,{method:t,params:e})},request:function(t,r){var n=this;"object"!==e(this._pendings)&&(this._pendings={});var o=W();return new Promise((function(e,i){n._pendings[o]={resolve:e,reject:i},y(a(B),"_send",n).call(n,{method:t,params:r,id:o})}))},__handleRecieverResponse:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].resolve(t.result),this._deleteRequest(t.id))},__handleRecieverResponseError:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].reject(t.error),this._deleteRequest(t.id))},_hasRequest:function(t){return"object"===e(this._pendings)&&this._pendings[t]},_deleteRequest:function(t){this._hasRequest(t)&&delete this._pendings[t]}},Q=U={__proto__:x,respond:function(t,e){y(a(U),"_send",this).call(this,{id:t,result:e})}},G=function(t){function e(t){var n;return r(this,e),i(d(n=_(this,a(e).call(this))),"__handleReceiverRequest",(function(t){n.emit("request",t,d(n))})),i(d(n),"__handleReceiverError",(function(t){n.emit("error",t,d(n))})),n._ws=t,n._reciever=new T,n._reciever.on("error",n.__handleReceiverError),n._reciever.on("request",n.__handleReceiverRequest),n._reciever.on("response",n.__handleRecieverResponse.bind(d(n))),n._reciever.on("response_error",n.__handleRecieverResponseError.bind(d(n))),n}return c(e,D),o(e,[{key:"addEventListener",value:function(t,e){this._ws.addEventListener(t,e)}},{key:"binaryType",get:function(){return this._ws.binaryType},set:function(t){this._ws.binaryType=t}},{key:"bufferedAmount",get:function(){return this._ws.bufferedAmount}},{key:"extensions",get:function(){return this._ws.extensions}},{key:"onclose",get:function(){return this._ws.onclose},set:function(t){this._ws.onclose=t}},{key:"onerror",get:function(){return this._ws.onerror},set:function(t){this._ws.onerror=t}},{key:"onmessage",get:function(){return this._ws.onmessage},set:function(t){this._ws.onmessage=t}},{key:"onopen",get:function(){return this._ws.onopen},set:function(t){this._ws.onopen=t}},{key:"protocol",get:function(){return this._ws.protocol}},{key:"readyState",get:function(){return this._ws.readyState}},{key:"url",get:function(){return this._ws.url},set:function(t){this._ws.url=t}}]),e}();Object.assign(G.prototype,J,z,Q);var H=u({BrowserRPCWebSocket:function(t){function e(){var t;r(this,e);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(t=_(this,a(e).call(this,l(WebSocket,o)))).onmessage=t._reciever.onMessage,t}return c(e,G),o(e,[{key:"close",value:function(){var t;(t=this._ws).close.apply(t,arguments)}}]),e}()},E);export default H;
