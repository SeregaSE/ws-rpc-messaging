var RPCClient=function(){"use strict";function t(r){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(r)}function r(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function e(t,r){for(var e=0;e<r.length;e++){var n=r[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}function o(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}function i(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,n)}return e}function s(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?i(Object(e),!0).forEach((function(r){o(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):i(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}function u(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),r&&a(t,r)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,r){return(a=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t,r,e){return(h=f()?Reflect.construct:function(t,r,e){var n=[null];n.push.apply(n,r);var o=new(Function.bind.apply(t,n));return e&&a(o,e.prototype),o}).apply(null,arguments)}function l(t){var r="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,n)}function n(){return h(t,arguments,c(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,r){return!r||"object"!=typeof r&&"function"!=typeof r?p(t):r}function y(t,r,e){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,r,e){var n=function(t,r){for(;!Object.prototype.hasOwnProperty.call(t,r)&&null!==(t=c(t)););return t}(t,r);if(n){var o=Object.getOwnPropertyDescriptor(n,r);return o.get?o.get.call(e):o.value}})(t,r,e||t)}var m,g=function(t){function e(t,n,o){var i;return r(this,e),(i=d(this,c(e).call(this,n))).code=t,i.data=o,i.name=i.constructor.name,Error.captureStackTrace(p(i),i.constructor),i}return u(e,t),n(e,[{key:"toJSON",value:function(){return{code:this.code,data:this.data,message:this.message}}}]),e}(l(Error)),_="Parse error",v=-32700,w="Invalid request",b=-32600,j="Method not found",E=-32601,O="Invalid params",R=-32602,S="Internal error",k=-32603,P=function(t){function e(t){return r(this,e),d(this,c(e).call(this,k,S,t))}return u(e,t),e}(g),q=function(t){function e(t){return r(this,e),d(this,c(e).call(this,R,O,t))}return u(e,t),e}(g),D=function(t){function e(t){return r(this,e),d(this,c(e).call(this,b,w,t))}return u(e,t),e}(g),M=function(t){function e(t){return r(this,e),d(this,c(e).call(this,E,j,t))}return u(e,t),e}(g),x=function(t){function e(t){return r(this,e),d(this,c(e).call(this,v,_,t))}return u(e,t),e}(g),A=function(){function t(){r(this,t),this._handlers={}}return n(t,[{key:"_has",value:function(t){return Array.isArray(this._handlers[t])}},{key:"on",value:function(t,r){this._has(t)||(this._handlers[t]=[]),this._handlers[t].push(r)}},{key:"emit",value:function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];this._has(t)&&this._handlers[t].forEach((function(t){t.apply(void 0,e)}))}},{key:"remove",value:function(t,r){this._has(t)&&(this._handlers[t]=this._handlers[t].filter((function(t){return t!==r})))}}]),t}(),I=function(){function t(e){r(this,t),this.jsonrpc=e}return n(t,[{key:"toString",value:function(){return{jsonrpc:this.jsonrpc}}},{key:"jsonrpc",get:function(){return this._jsonrpc},set:function(t){if("2.0"!==t)throw new Error("jsonrpc is required, ".concat("2.0"," expected"));this._jsonrpc=t}}]),t}(),C=function(e){function o(t,e,n){var i;return r(this,o),(i=d(this,c(o).call(this,t))).error=e,i.id=n,i}return u(o,e),n(o,[{key:"toString",value:function(){return s({},y(c(o.prototype),"toString",this).call(this),{error:this.error,id:this.id})}},{key:"error",get:function(){return this._error},set:function(r){if("object"!==t(r))throw new Error("error must be object");if("number"!=typeof r.code)throw new Error("error must has code, typeof number");if("string"!=typeof r.message||0===r.message.length)throw new Error("error must has message, typeof string, not empty");this._error=r}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),o}(I),N=function(e){function o(t,e,n,i){var s;return r(this,o),(s=d(this,c(o).call(this,t))).method=e,s.params=n,s.id=i,s}return u(o,e),n(o,[{key:"toString",value:function(){return s({},y(c(o.prototype),"toString",this).call(this),{method:this.method,params:this.params,id:this.id})}},{key:"method",get:function(){return this._method},set:function(t){if("string"==typeof t&&t.length>0)return this._method=t;throw new Error("method must be not empty string")}},{key:"params",get:function(){return this._params},set:function(r){if(null===r)throw new Error("params must be ommited | array | object, got null");if("object"===t(r)||void 0===r)return this._params=r;throw new Error("params must be ommited | array | object")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null==t)return this._id=t;throw new Error("id must be ommited | int | string | null")}}]),o}(I),J=function(t){function e(t,n,o){var i;return r(this,e),(i=d(this,c(e).call(this,t))).result=n,i.id=o,i}return u(e,t),n(e,[{key:"toString",value:function(){return s({},y(c(e.prototype),"toString",this).call(this),{result:this.result,id:this.id})}},{key:"result",get:function(){return this._result},set:function(t){if(void 0!==t)return this._result=t;throw new Error("result is required")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),e}(I),T=function(e){function i(){var e;return r(this,i),o(p(e=d(this,c(i).call(this))),"onMessage",(function(t){var r=e._toJson(t);e._toMessages(r).forEach(e._parseMessage)})),o(p(e),"_parseMessage",(function(r){if("object"!==t(r))return e.emit("error",new x("message in not an object, ".concat(t(r)," recieved")));var n,o,i=r.jsonrpc,s=r.method,u=r.params,c=r.result,a=r.error,f=r.id;try{void 0!==s&&(n="request",o=new N(i,s,u,f)),void 0!==c&&(n="response",o=new J(i,c,f)),void 0!==a&&(n="response_error",o=new C(i,a,f))}catch(a){return e.emit("error",new x(a.message))}return n&&o?e.emit(n,o):e.emit("error",new x("invalid message, json-rpc 2.0 format required"))})),e}return u(i,e),n(i,[{key:"_toJson",value:function(t){try{return JSON.parse(t)}catch(t){this.emit("error",new x(t.message))}}},{key:"_toMessages",value:function(t){return Array.isArray(t)?t:[t]}}]),i}(A),V=function(t){return t._rpcreciever=new T,t._rpcreciever.on("error",t.handleReceiverError.bind(t)),t._rpcreciever.on("request",t.handleReceiverRequest.bind(t)),t._rpcreciever.on("response",t.handleRecieverResponse.bind(t)),t._rpcreciever.on("response_error",t.handleRecieverResponseError.bind(t)),t},F={_send:function(t){this.send(JSON.stringify(s({jsonrpc:"2.0"},t)))}},U=m={__proto__:F,throw:function(t,r){y(c(m),"_send",this).call(this,{id:t,error:r})},throwRPCError:function(t,r,e,n){this.throw(t,new g(r,e,n))},_throwDefaultError:function(t,r,e){this.throw(t,new e(r))},throwParseError:function(t,r){this._throwDefaultError(t,r,x)},throwInvalidRequest:function(t,r){this._throwDefaultError(t,r,D)},throwNotFound:function(t,r){this._throwDefaultError(t,r,M)},throwInvalidParams:function(t,r){this._throwDefaultError(t,r,q)},throwInternalError:function(t,r){this._throwDefaultError(t,r,P)}},W={handleReceiverError:function(t){this.emit("recieve-error",t,this)},handleReceiverRequest:function(t){this.emit("request",t,this)}};for(var z=function(t,r){return t(r={exports:{}},r.exports),r.exports}((function(t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var e=new Uint8Array(16);t.exports=function(){return r(e),e}}else{var n=new Array(16);t.exports=function(){for(var t,r=0;r<16;r++)0==(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n}}})),B=[],G=0;G<256;++G)B[G]=(G+256).toString(16).substr(1);var H=function(t,r){var e=r||0,n=B;return[n[t[e++]],n[t[e++]],n[t[e++]],n[t[e++]],"-",n[t[e++]],n[t[e++]],"-",n[t[e++]],n[t[e++]],"-",n[t[e++]],n[t[e++]],"-",n[t[e++]],n[t[e++]],n[t[e++]],n[t[e++]],n[t[e++]],n[t[e++]]].join("")};var K,L,Q=function(t,r,e){var n=r&&e||0;"string"==typeof t&&(r="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||z)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,r)for(var i=0;i<16;++i)r[n+i]=o[i];return r||H(o)},X=K={__proto__:F,notify:function(t,r){y(c(K),"_send",this).call(this,{method:t,params:r})},request:function(r,e){var n=this;"object"!==t(this._pendings)&&(this._pendings={});var o=Q();return new Promise((function(t,i){n._pendings[o]={resolve:t,reject:i},y(c(K),"_send",n).call(n,{method:r,params:e,id:o})}))},handleRecieverResponse:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].resolve(t.result),this._deleteRequest(t.id))},handleRecieverResponseError:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].reject(t.error),this._deleteRequest(t.id))},_hasRequest:function(r){return"object"===t(this._pendings)&&this._pendings[r]},_deleteRequest:function(t){this._hasRequest(t)&&delete this._pendings[t]}},Y=L={__proto__:F,respond:function(t,r){y(c(L),"_send",this).call(this,{id:t,result:r})}},Z=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.assign(t.__proto__,U,W,X,Y,r),V(t),t.onmessage=t.__onMessage,t},$=function(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];return Z.apply(void 0,[t].concat(e)),t.onmessage=function(r){t._rpcreciever.onMessage(r.data)},t};return function(t){function e(){var t,n;r(this,e);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return n=d(this,(t=c(e)).call.apply(t,[this].concat(i))),$(p(n)),n}return u(e,t),e}(l(WebSocket))}();
