var RPCClient=function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function s(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,r){return(h=f()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&a(o,r.prototype),o}).apply(null,arguments)}function l(t){var e="function"==typeof Map?new Map:void 0;return(l=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return h(t,arguments,c(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function d(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?p(t):e}function y(t,e,r){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}var _,g=function(t){function r(t,n,o){var i;return e(this,r),(i=d(this,c(r).call(this,n))).code=t,i.data=o,i.name=i.constructor.name,Error.captureStackTrace(p(i),i.constructor),i}return u(r,t),n(r,[{key:"toJSON",value:function(){return{code:this.code,data:this.data,message:this.message}}}]),r}(l(Error)),m="Parse error",w=-32700,b="Invalid request",v=-32600,j="Method not found",E=-32601,O="Invalid params",R=-32602,k="Internal error",S=-32603,P=function(t){function r(t){return e(this,r),d(this,c(r).call(this,S,k,t))}return u(r,t),r}(g),q=function(t){function r(t){return e(this,r),d(this,c(r).call(this,R,O,t))}return u(r,t),r}(g),D=function(t){function r(t){return e(this,r),d(this,c(r).call(this,v,b,t))}return u(r,t),r}(g),x=function(t){function r(t){return e(this,r),d(this,c(r).call(this,E,j,t))}return u(r,t),r}(g),M=function(t){function r(t){return e(this,r),d(this,c(r).call(this,w,m,t))}return u(r,t),r}(g),A=function(){function t(){e(this,t),this._handlers={}}return n(t,[{key:"_has",value:function(t){return Array.isArray(this._handlers[t])}},{key:"on",value:function(t,e){this._has(t)||(this._handlers[t]=[]),this._handlers[t].push(e)}},{key:"emit",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];this._has(t)&&this._handlers[t].forEach((function(t){t.apply(void 0,r)}))}},{key:"remove",value:function(t,e){this._has(t)&&(this._handlers[t]=this._handlers[t].filter((function(t){return t!==e})))}}]),t}(),I=function(){function t(r){e(this,t),this.jsonrpc=r}return n(t,[{key:"toString",value:function(){return{jsonrpc:this.jsonrpc}}},{key:"jsonrpc",get:function(){return this._jsonrpc},set:function(t){if("2.0"!==t)throw new Error("jsonrpc is required, ".concat("2.0"," expected"));this._jsonrpc=t}}]),t}(),C=function(r){function o(t,r,n){var i;return e(this,o),(i=d(this,c(o).call(this,t))).error=r,i.id=n,i}return u(o,r),n(o,[{key:"toString",value:function(){return s({},y(c(o.prototype),"toString",this).call(this),{error:this.error,id:this.id})}},{key:"error",get:function(){return this._error},set:function(e){if("object"!==t(e))throw new Error("error must be object");if("number"!=typeof e.code)throw new Error("error must has code, typeof number");if("string"!=typeof e.message||0===e.message.length)throw new Error("error must has message, typeof string, not empty");this._error=e}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),o}(I),N=function(r){function o(t,r,n,i){var s;return e(this,o),(s=d(this,c(o).call(this,t))).method=r,s.params=n,s.id=i,s}return u(o,r),n(o,[{key:"toString",value:function(){return s({},y(c(o.prototype),"toString",this).call(this),{method:this.method,params:this.params,id:this.id})}},{key:"method",get:function(){return this._method},set:function(t){if("string"==typeof t&&t.length>0)return this._method=t;throw new Error("method must be not empty string")}},{key:"params",get:function(){return this._params},set:function(e){if(null===e)throw new Error("params must be ommited | array | object, got null");if("object"===t(e)||void 0===e)return this._params=e;throw new Error("params must be ommited | array | object")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null==t)return this._id=t;throw new Error("id must be ommited | int | string | null")}}]),o}(I),T=function(t){function r(t,n,o){var i;return e(this,r),(i=d(this,c(r).call(this,t))).result=n,i.id=o,i}return u(r,t),n(r,[{key:"toString",value:function(){return s({},y(c(r.prototype),"toString",this).call(this),{result:this.result,id:this.id})}},{key:"result",get:function(){return this._result},set:function(t){if(void 0!==t)return this._result=t;throw new Error("result is required")}},{key:"id",get:function(){return this._id},set:function(t){if("number"==typeof t){if(Number.isInteger(t))return this._id=t;throw new Error("id must be integer, got ".concat(t))}if("string"==typeof t){if(t.length>0)return this._id=t;throw new Error("id must be not empty string")}if(null===t)return this._id=t;throw new Error("id must be | int | string | null")}}]),r}(I),J=function(r){function i(){var r;return e(this,i),o(p(r=d(this,c(i).call(this))),"onMessage",(function(t){var e=r._toJson(t);r._toMessages(e).forEach(r._parseMessage)})),o(p(r),"_parseMessage",(function(e){if("object"!==t(e))return r.emit("error",new M("message in not an object, ".concat(t(e)," recieved")));var n,o,i=e.jsonrpc,s=e.method,u=e.params,c=e.result,a=e.error,f=e.id;try{void 0!==s&&(n="request",o=new N(i,s,u,f)),void 0!==c&&(n="response",o=new T(i,c,f)),void 0!==a&&(n="response_error",o=new C(i,a,f))}catch(a){return r.emit("error",new M(a.message))}return n&&o?r.emit(n,o):r.emit("error",new M("invalid message, json-rpc 2.0 format required"))})),r}return u(i,r),n(i,[{key:"_toJson",value:function(t){try{return JSON.parse(t)}catch(t){this.emit("error",new M(t.message))}}},{key:"_toMessages",value:function(t){return Array.isArray(t)?t:[t]}}]),i}(A),V={_send:function(t){this._ws.send(JSON.stringify(s({jsonrpc:"2.0"},t)))}},F=_={__proto__:V,throw:function(t,e){y(c(_),"_send",this).call(this,{id:t,error:e})},throwRPCError:function(t,e,r,n){this.throw(t,new g(e,r,n))},_throwDefaultError:function(t,e,r){this.throw(t,new r(e))},throwParseError:function(t,e){this._throwDefaultError(t,e,M)},throwInvalidRequest:function(t,e){this._throwDefaultError(t,e,D)},throwNotFound:function(t,e){this._throwDefaultError(t,e,x)},throwInvalidParams:function(t,e){this._throwDefaultError(t,e,q)},throwInternalError:function(t,e){this._throwDefaultError(t,e,P)}};for(var L=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var r=new Uint8Array(16);t.exports=function(){return e(r),r}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}})),U=[],W=0;W<256;++W)U[W]=(W+256).toString(16).substr(1);var z=function(t,e){var r=e||0,n=U;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")};var B,G,H=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var o=(t=t||{}).random||(t.rng||L)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e)for(var i=0;i<16;++i)e[n+i]=o[i];return e||z(o)},K=B={__proto__:V,notify:function(t,e){y(c(B),"_send",this).call(this,{method:t,params:e})},request:function(e,r){var n=this;"object"!==t(this._pendings)&&(this._pendings={});var o=H();return new Promise((function(t,i){n._pendings[o]={resolve:t,reject:i},y(c(B),"_send",n).call(n,{method:e,params:r,id:o})}))},__handleRecieverResponse:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].resolve(t.result),this._deleteRequest(t.id))},__handleRecieverResponseError:function(t){this._hasRequest(t.id)&&(this._pendings[t.id].reject(t.error),this._deleteRequest(t.id))},_hasRequest:function(e){return"object"===t(this._pendings)&&this._pendings[e]},_deleteRequest:function(t){this._hasRequest(t)&&delete this._pendings[t]}},Q=G={__proto__:V,respond:function(t,e){y(c(G),"_send",this).call(this,{id:t,result:e})}},X=function(t){function r(t){var n;return e(this,r),o(p(n=d(this,c(r).call(this))),"__handleReceiverRequest",(function(t){n.emit("request",t,p(n))})),o(p(n),"__handleReceiverError",(function(t){n.emit("error",t,p(n))})),n._ws=t,n._reciever=new J,n._reciever.on("error",n.__handleReceiverError),n._reciever.on("request",n.__handleReceiverRequest),n._reciever.on("response",n.__handleRecieverResponse.bind(p(n))),n._reciever.on("response_error",n.__handleRecieverResponseError.bind(p(n))),n}return u(r,t),n(r,[{key:"addEventListener",value:function(t,e){this._ws.addEventListener(t,e)}},{key:"binaryType",get:function(){return this._ws.binaryType},set:function(t){this._ws.binaryType=t}},{key:"bufferedAmount",get:function(){return this._ws.bufferedAmount}},{key:"extensions",get:function(){return this._ws.extensions}},{key:"onclose",get:function(){return this._ws.onclose},set:function(t){this._ws.onclose=t}},{key:"onerror",get:function(){return this._ws.onerror},set:function(t){this._ws.onerror=t}},{key:"onmessage",get:function(){return this._ws.onmessage},set:function(t){this._ws.onmessage=t}},{key:"onopen",get:function(){return this._ws.onopen},set:function(t){this._ws.onopen=t}},{key:"protocol",get:function(){return this._ws.protocol}},{key:"readyState",get:function(){return this._ws.readyState}},{key:"url",get:function(){return this._ws.url},set:function(t){this._ws.url=t}}]),r}(A);return Object.assign(X.prototype,F,K,Q),function(t){function r(){var t;e(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return o(p(t=d(this,c(r).call(this,h(WebSocket,i)))),"_onMessage",(function(e){t._reciever.onMessage(e.data)})),t.onmessage=t._onMessage,t}return u(r,t),n(r,[{key:"close",value:function(){var t;(t=this._ws).close.apply(t,arguments)}}]),r}(X)}();
